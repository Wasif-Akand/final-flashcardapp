<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MonoFlash</title>
    <style>
        /* --- CORE VARIABLES & RESET --- */
        :root {
            --bg: #000000;
            --surface: #111111;
            --border: #333333;
            --text: #ffffff;
            --text-dim: #888888;
            --accent: #ffffff;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0;
            background: var(--bg); color: var(--text);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            height: 100vh; display: flex; overflow: hidden;
        }

        /* --- SIDEBAR (DRAWER) --- */
        #sidebar {
            width: 280px; background: var(--surface);
            border-right: 1px solid var(--border);
            display: flex; flex-direction: column;
            position: absolute; left: -280px; top: 0; bottom: 0;
            transition: left 0.3s ease; z-index: 1000;
        }
        #sidebar.open { left: 0; }
        
        .sidebar-header { padding: 20px; border-bottom: 1px solid var(--border); font-weight: bold; }
        .sidebar-content { flex: 1; overflow-y: auto; padding: 10px; }
        
        .subject-item { margin-bottom: 10px; }
        .subject-title { font-weight: bold; padding: 10px; cursor: pointer; display: flex; justify-content: space-between; }
        .sub-subject-list { margin-left: 15px; border-left: 1px solid var(--border); display: none; }
        .sub-subject-list.show { display: block; }
        .sub-item { padding: 10px; color: var(--text-dim); cursor: pointer; }
        .sub-item:hover, .sub-item.active { color: var(--text); background: #222; }

        .add-btn { padding: 10px; border: 1px dashed var(--border); text-align: center; margin-top: 10px; cursor: pointer; color: var(--text-dim); }

        /* --- MAIN CONTENT --- */
        #main { flex: 1; display: flex; flex-direction: column; position: relative; width: 100%; transition: opacity 0.3s; }
        
        /* Header */
        header { 
            padding: 15px; border-bottom: 1px solid var(--border); 
            display: flex; align-items: center; gap: 15px; 
        }
        .menu-btn { font-size: 1.5rem; cursor: pointer; }

        /* Content Area */
        #content-area { flex: 1; overflow-y: auto; padding: 20px; position: relative; }
        
        /* --- TABS (Flashcard / Perf / DB) --- */
        .tab-view { display: none; height: 100%; }
        .tab-view.active { display: flex; flex-direction: column; }

        /* FLASHCARD STYLES */
        .flashcard-container { flex: 1; display: flex; justify-content: center; align-items: center; perspective: 1000px; }
        .card {
            width: 100%; max-width: 400px; height: 300px;
            position: relative; transform-style: preserve-3d; transition: transform 0.6s;
            cursor: pointer;
        }
        .card.flipped { transform: rotateY(180deg); }
        .card-face {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden;
            display: flex; justify-content: center; align-items: center; text-align: center;
            border: 2px solid var(--border); border-radius: 15px; background: var(--surface);
            padding: 20px; font-size: 1.5rem;
        }
        .card-back { transform: rotateY(180deg); background: #000; border-color: #fff; }

        .controls { display: flex; gap: 10px; justify-content: center; margin-top: 20px; }
        .btn { padding: 12px 24px; border-radius: 8px; border: 1px solid var(--border); background: var(--surface); color: white; cursor: pointer; }
        .btn-primary { background: white; color: black; border: none; }

        /* DATABASE STYLES */
        textarea { width: 100%; height: 100px; background: #000; color: #fff; border: 1px solid var(--border); padding: 10px; margin-bottom: 10px; }
        .db-item { padding: 10px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; }
        .db-key { font-weight: bold; }

        /* PERFORMANCE STYLES */
        .stat-box { border: 1px solid var(--border); padding: 20px; margin-bottom: 10px; border-radius: 8px; text-align: center; }
        .stat-num { font-size: 2rem; font-weight: bold; }

        /* --- BOTTOM NAV --- */
        nav { display: flex; border-top: 1px solid var(--border); padding-bottom: env(safe-area-inset-bottom); background: var(--bg); }
        .nav-item { flex: 1; padding: 15px; text-align: center; color: var(--text-dim); cursor: pointer; font-size: 0.9rem; border-top: 2px solid transparent; }
        .nav-item.active { color: white; border-top-color: white; }

        /* Overlay for sidebar */
        #overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 900; display: none; }
        #overlay.show { display: block; }

    </style>
</head>
<body>

    <div id="overlay" onclick="toggleSidebar()"></div>
    <aside id="sidebar">
        <div class="sidebar-header">SUBJECTS</div>
        <div class="sidebar-content" id="subject-list">
            </div>
        <div class="add-btn" onclick="addNewSubject()">+ Add Subject</div>
    </aside>

    <main id="main">
        <header>
            <div class="menu-btn" onclick="toggleSidebar()">☰</div>
            <h1 id="header-title" style="font-size: 1.2rem; margin:0;">Select a Subject</h1>
        </header>

        <section id="content-area">
            
            <div id="tab-flashcard" class="tab-view active">
                <div class="flashcard-container">
                    <div class="card" onclick="flipCard()" id="active-card">
                        <div class="card-face card-front" id="card-front">Select a sub-subject</div>
                        <div class="card-face card-back" id="card-back">...to start</div>
                    </div>
                </div>
                <div class="controls">
                    <button class="btn" onclick="nextCard(false)">Missed</button>
                    <button class="btn btn-primary" onclick="nextCard(true)">Got it</button>
                </div>
            </div>

            <div id="tab-performance" class="tab-view">
                <div class="stat-box">
                    <div class="stat-num" id="stat-total">0</div>
                    <div>Cards Reviewed</div>
                </div>
                <div class="stat-box" style="border-color: #fff;">
                    <div class="stat-num" id="stat-score">0%</div>
                    <div>Accuracy</div>
                </div>
            </div>

            <div id="tab-database" class="tab-view">
                <h3>Add Data (JSON)</h3>
                <p style="color:#666; font-size: 0.8rem;">Format: [{"q":"Front", "a":"Back"}]</p>
                <textarea id="json-input" placeholder='[{"q":"Question", "a":"Answer"}]'></textarea>
                <button class="btn btn-primary" style="width:100%" onclick="importJson()">Import JSON</button>
                
                <h3>Current Entries</h3>
                <div id="db-list"></div>
            </div>

        </section>

        <nav>
            <div class="nav-item active" onclick="switchTab('flashcard', this)">STUDY</div>
            <div class="nav-item" onclick="switchTab('performance', this)">STATS</div>
            <div class="nav-item" onclick="switchTab('database', this)">DATA</div>
        </nav>
    </main>

    <script>
        // --- DATA STORE ---
        // Structure: { "Physics": { "Motion": [ {q, a, stats} ] } }
        let appData = JSON.parse(localStorage.getItem('monoFlashData')) || {};
        let currentSubject = null;
        let currentSub = null;
        let cardIndex = 0;
        let sessionStats = { total: 0, correct: 0 };

        // --- SIDEBAR & NAV LOGIC ---
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
            document.getElementById('overlay').classList.toggle('show');
        }

        function renderSidebar() {
            const container = document.getElementById('subject-list');
            container.innerHTML = '';

            Object.keys(appData).forEach(sub => {
                const subDiv = document.createElement('div');
                subDiv.className = 'subject-item';
                
                const title = document.createElement('div');
                title.className = 'subject-title';
                title.innerHTML = `${sub} <span>▾</span>`;
                title.onclick = () => document.getElementById(`list-${sub}`).classList.toggle('show');

                const list = document.createElement('div');
                list.className = 'sub-subject-list';
                list.id = `list-${sub}`;
                
                // Add "Add Sub-subject" button inside list
                const addSubBtn = document.createElement('div');
                addSubBtn.className = 'sub-item';
                addSubBtn.innerText = '+ New Topic';
                addSubBtn.style.fontStyle = 'italic';
                addSubBtn.onclick = () => addNewSubSubject(sub);
                list.appendChild(addSubBtn);

                Object.keys(appData[sub]).forEach(topic => {
                    const item = document.createElement('div');
                    item.className = 'sub-item';
                    item.innerText = topic;
                    item.onclick = () => loadTopic(sub, topic);
                    list.appendChild(item);
                });

                subDiv.appendChild(title);
                subDiv.appendChild(list);
                container.appendChild(subDiv);
            });
        }

        function addNewSubject() {
            const name = prompt("Enter Subject Name (e.g., Physics):");
            if (name && !appData[name]) {
                appData[name] = {};
                saveData();
                renderSidebar();
            }
        }

        function addNewSubSubject(subject) {
            const name = prompt(`Enter Topic for ${subject} (e.g., Motion):`);
            if (name && !appData[subject][name]) {
                appData[subject][name] = []; // Empty array for cards
                saveData();
                renderSidebar();
            }
        }

        // --- CORE FUNCTIONALITY ---
        function loadTopic(sub, topic) {
            currentSubject = sub;
            currentSub = topic;
            cardIndex = 0;
            sessionStats = { total: 0, correct: 0 };
            
            document.getElementById('header-title').innerText = `${sub} / ${topic}`;
            toggleSidebar(); // Close sidebar
            renderCard();
            renderDbList();
            updateStats();
        }

        function switchTab(tabId, navEl) {
            document.querySelectorAll('.tab-view').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            
            document.getElementById(`tab-${tabId}`).classList.add('active');
            navEl.classList.add('active');
        }

        // --- FLASHCARD LOGIC ---
        function renderCard() {
            const cardEl = document.getElementById('active-card');
            const frontEl = document.getElementById('card-front');
            const backEl = document.getElementById('card-back');
            
            cardEl.classList.remove('flipped'); // Reset flip
            
            if (!currentSubject || !appData[currentSubject][currentSub].length) {
                frontEl.innerText = "No cards here.";
                backEl.innerText = "Go to DATA tab to add JSON.";
                return;
            }

            const cards = appData[currentSubject][currentSub];
            // Loop if we reach end
            if (cardIndex >= cards.length) cardIndex = 0;

            const card = cards[cardIndex];
            frontEl.innerText = card.q;
            backEl.innerText = card.a;
        }

        function flipCard() {
            document.getElementById('active-card').classList.toggle('flipped');
        }

        function nextCard(isCorrect) {
            if (!currentSubject) return;
            
            // Update Stats
            sessionStats.total++;
            if (isCorrect) sessionStats.correct++;
            updateStats();

            // Next card
            cardIndex++;
            renderCard();
        }

        function updateStats() {
            document.getElementById('stat-total').innerText = sessionStats.total;
            const percentage = sessionStats.total === 0 ? 0 : Math.round((sessionStats.correct / sessionStats.total) * 100);
            document.getElementById('stat-score').innerText = percentage + "%";
        }

        // --- DATABASE LOGIC ---
        function importJson() {
            if (!currentSubject || !currentSub) {
                alert("Please select a Subject and Topic from the sidebar first.");
                return;
            }

            const input = document.getElementById('json-input').value;
            try {
                const newCards = JSON.parse(input);
                if (Array.isArray(newCards)) {
                    // Append new cards to existing ones
                    appData[currentSubject][currentSub].push(...newCards);
                    saveData();
                    alert(`Added ${newCards.length} cards!`);
                    document.getElementById('json-input').value = ''; // Clear
                    renderDbList();
                    renderCard(); // Refresh current view
                } else {
                    alert("JSON must be an array: [...]");
                }
            } catch (e) {
                alert("Invalid JSON format");
            }
        }

        function renderDbList() {
            const list = document.getElementById('db-list');
            list.innerHTML = '';
            
            if (!currentSubject) return;

            const cards = appData[currentSubject][currentSub];
            cards.forEach((c, idx) => {
                const item = document.createElement('div');
                item.className = 'db-item';
                item.innerHTML = `
                    <div>
                        <div class="db-key">Q: ${c.q}</div>
                        <div style="color:#666">A: ${c.a}</div>
                    </div>
                    <button onclick="deleteCard(${idx})" style="background:none; border:none; color:red;">✕</button>
                `;
                list.appendChild(item);
            });
        }

        function deleteCard(index) {
            if(confirm('Delete this card?')) {
                appData[currentSubject][currentSub].splice(index, 1);
                saveData();
                renderDbList();
                renderCard();
            }
        }

        function saveData() {
            localStorage.setItem('monoFlashData', JSON.stringify(appData));
        }

        // --- INIT ---
        renderSidebar();

    </script>
</body>
</html>
